<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Scanner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <link rel="manifest" href="#" id="manifestPlaceholder">
    <style>
        :root {
            --primary-color: #6200ee;
            --primary-dark: #3700b3;
            --secondary-color: #03dac6;
            --background: #f5f5f5;
            --card-bg: #ffffff;
            --text-color: #333333;
            --light-gray: #e0e0e0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 80px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        main {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
        }

        .camera-container {
            position: relative;
            width: 100%;
            margin: 1rem 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #video {
            width: 100%;
            background-color: #000;
            display: block;
        }

        #canvas {
            display: none;
        }

        #capturedImage {
            width: 100%;
            display: none;
            border-radius: 8px;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            margin: 0.5rem 0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #018786;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .loading {
            text-align: center;
            margin: 1rem 0;
            display: none;
        }

        .loading-spinner {
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .book-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-top: 2rem;
        }

        .book-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-5px);
        }

        .book-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .book-author {
            color: #666;
            margin-bottom: 0.5rem;
        }

        .book-info {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 0.5rem;
        }

        .book-description {
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .book-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .rating {
            display: flex;
            align-items: center;
        }

        .rating select {
            margin-left: 0.5rem;
            padding: 0.25rem;
            border-radius: 4px;
            border: 1px solid var(--light-gray);
        }

        .read-status {
            display: flex;
            align-items: center;
        }

        .read-status input {
            margin-right: 0.5rem;
        }

        .delete-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            color: #ff5252;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .empty-state {
            text-align: center;
            margin: 3rem 0;
            color: #999;
        }

        .tab-container {
            display: flex;
            justify-content: center;
            margin: 1rem 0;
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tab {
            padding: 0.75rem 1.25rem;
            flex: 1;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        #scannerTab, #libraryTab {
            display: none;
        }

        #scannerTab.active, #libraryTab.active {
            display: block;
        }

        .recognition-results {
            margin: 1rem 0;
            padding: 1rem;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .recognized-text {
            font-family: monospace;
            background-color: #f9f9f9;
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
            word-break: break-all;
        }

        .book-form {
            margin: 1rem 0;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group textarea {
            height: 100px;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
        }

        @media (min-width: 768px) {
            .book-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .install-prompt {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            display: none;
            align-items: center;
            justify-content: space-between;
        }

        .prompt-text {
            flex: 1;
        }

        #closePrompt {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .offline-banner {
            background-color: #ffebee;
            padding: 0.5rem 1rem;
            text-align: center;
            display: none;
        }

        #searchQuery {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="offline-banner" id="offlineBanner">
        You are currently offline. Some features may not be available.
    </div>

    <header>
        <h1>Book Scanner</h1>
    </header>

    <main>
        <div class="install-prompt" id="installPrompt">
            <div class="prompt-text">
                <p>Add this app to your home screen for quick access!</p>
            </div>
            <button id="installButton" class="btn">Install</button>
            <button id="closePrompt">Ã—</button>
        </div>

        <div class="tab-container">
            <div class="tab active" data-tab="scannerTab">Scanner</div>
            <div class="tab" data-tab="libraryTab">My Library</div>
        </div>

        <div id="scannerTab" class="active">
            <div class="camera-container">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
                <img id="capturedImage" alt="Captured image">
            </div>

            <div class="btn-container">
                <button id="startCameraBtn" class="btn">Start Camera</button>
                <button id="captureBtn" class="btn" disabled>Capture Image</button>
                <button id="resetBtn" class="btn btn-secondary" disabled>Reset</button>
            </div>

            <div class="loading" id="loadingIndicator">
                <div class="loading-spinner"></div>
                <p id="loadingText">Processing image...</p>
            </div>

            <div class="recognition-results" id="recognitionResults" style="display: none;">
                <h3>Recognized Text:</h3>
                <div class="recognized-text" id="recognizedText"></div>
                
                <div class="form-group">
                    <label for="bookTitle">Book Title:</label>
                    <input type="text" id="bookTitle" placeholder="Enter book title">
                </div>

                <div class="btn-container">
                    <button id="searchBookBtn" class="btn">Search Book Info</button>
                </div>
            </div>

            <div class="book-form" id="bookForm" style="display: none;">
                <h3>Book Information</h3>
                <div class="form-group">
                    <label for="formBookTitle">Title:</label>
                    <input type="text" id="formBookTitle" required>
                </div>
                <div class="form-group">
                    <label for="formAuthor">Author:</label>
                    <input type="text" id="formAuthor">
                </div>
                <div class="form-group">
                    <label for="formYear">Year:</label>
                    <input type="text" id="formYear">
                </div>
                <div class="form-group">
                    <label for="formGenre">Genre:</label>
                    <input type="text" id="formGenre">
                </div>
                <div class="form-group">
                    <label for="formDescription">Description:</label>
                    <textarea id="formDescription"></textarea>
                </div>
                <div class="form-group">
                    <label>Read Status:</label>
                    <div class="read-status">
                        <input type="checkbox" id="formReadStatus">
                        <label for="formReadStatus">I have read this book</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="formRating">Rating:</label>
                    <select id="formRating">
                        <option value="0">Not rated</option>
                        <option value="1">1 - Poor</option>
                        <option value="2">2 - Fair</option>
                        <option value="3">3 - Good</option>
                        <option value="4">4 - Very Good</option>
                        <option value="5">5 - Excellent</option>
                    </select>
                </div>
                <div class="btn-container">
                    <button id="saveBookBtn" class="btn">Save to Library</button>
                    <button id="cancelBookBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <div id="libraryTab">
            <input type="text" id="searchQuery" placeholder="Search your books...">
            <div class="book-list" id="bookList"></div>
            <div class="empty-state" id="emptyState">
                <p>Your library is empty. Scan some books to add them!</p>
            </div>
        </div>
    </main>

    <div class="notification" id="notification"></div>

    <script>
        // DOM Elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const capturedImage = document.getElementById('capturedImage');
        const startCameraBtn = document.getElementById('startCameraBtn');
        const captureBtn = document.getElementById('captureBtn');
        const resetBtn = document.getElementById('resetBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingText = document.getElementById('loadingText');
        const recognitionResults = document.getElementById('recognitionResults');
        const recognizedText = document.getElementById('recognizedText');
        const bookTitle = document.getElementById('bookTitle');
        const searchBookBtn = document.getElementById('searchBookBtn');
        const bookForm = document.getElementById('bookForm');
        const formBookTitle = document.getElementById('formBookTitle');
        const formAuthor = document.getElementById('formAuthor');
        const formYear = document.getElementById('formYear');
        const formGenre = document.getElementById('formGenre');
        const formDescription = document.getElementById('formDescription');
        const formReadStatus = document.getElementById('formReadStatus');
        const formRating = document.getElementById('formRating');
        const saveBookBtn = document.getElementById('saveBookBtn');
        const cancelBookBtn = document.getElementById('cancelBookBtn');
        const bookList = document.getElementById('bookList');
        const emptyState = document.getElementById('emptyState');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('#scannerTab, #libraryTab');
        const searchQuery = document.getElementById('searchQuery');
        const notification = document.getElementById('notification');
        const installPrompt = document.getElementById('installPrompt');
        const installButton = document.getElementById('installButton');
        const closePrompt = document.getElementById('closePrompt');
        const offlineBanner = document.getElementById('offlineBanner');

        // Global variables
        let stream = null;
        let deferredPrompt = null;
        let books = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            loadBooks();
            renderBookList();
            setupTabNavigation();
            setupSearchFunctionality();
            setupServiceWorker();
            setupInstallPrompt();
        });

        // Function to set up tab navigation
        function setupTabNavigation() {
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update active content
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabId) {
                            content.classList.add('active');
                        }
                    });
                });
            });
        }

        // Function to set up search functionality
        function setupSearchFunctionality() {
            searchQuery.addEventListener('input', () => {
                const query = searchQuery.value.toLowerCase();
                renderBookList(query);
            });
        }

        // Function to set up service worker
        function setupServiceWorker() {
            // Create dynamic manifest
            const manifestData = {
                "name": "Book Scanner",
                "short_name": "BookScan",
                "start_url": ".",
                "display": "standalone",
                "background_color": "#ffffff",
                "theme_color": "#6200ee",
                "icons": [
                    {
                        "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%236200ee' d='M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm101.8-262.2L295.6 256l62.2 62.2c4.7 4.7 4.7 12.3 0 17l-22.6 22.6c-4.7 4.7-12.3 4.7-17 0L256 295.6l-62.2 62.2c-4.7 4.7-12.3 4.7-17 0l-22.6-22.6c-4.7-4.7-4.7-12.3 0-17l62.2-62.2-62.2-62.2c-4.7-4.7-4.7-12.3 0-17l22.6-22.6c4.7-4.7 12.3-4.7 17 0l62.2 62.2 62.2-62.2c4.7-4.7 12.3-4.7 17 0l22.6 22.6c4.7 4.7 4.7 12.3 0 17z'/%3E%3C/svg%3E",
                        "sizes": "512x512",
                        "type": "image/svg+xml"
                    }
                ]
            };

            const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(manifestBlob);
            document.getElementById('manifestPlaceholder').setAttribute('href', manifestURL);

            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                    
                    // Create a minimal service worker on-the-fly
                    const swCode = `
                        self.addEventListener('install', (event) => {
                            self.skipWaiting();
                        });

                        self.addEventListener('activate', (event) => {
                            return self.clients.claim();
                        });

                        self.addEventListener('fetch', (event) => {
                            event.respondWith(fetch(event.request).catch(() => {
                                return new Response('Network error occurred. App is running in offline mode.');
                            }));
                        });
                    `;
                    
                    const swBlob = new Blob([swCode], {type: 'text/javascript'});
                    const swURL = URL.createObjectURL(swBlob);
                    
                    navigator.serviceWorker.register(swURL).then(registration => {
                        console.log('Fallback ServiceWorker registered successfully');
                    }).catch(error => {
                        console.error('Fallback ServiceWorker registration failed:', error);
                    });
                });
            }

            // Online/offline detection
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();
        }

        // Function to update online status
        function updateOnlineStatus() {
            if (navigator.onLine) {
                offlineBanner.style.display = 'none';
            } else {
                offlineBanner.style.display = 'block';
            }
        }

        // Function to set up install prompt
        function setupInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installPrompt.style.display = 'flex';
            });

            installButton.addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            showNotification('App installed successfully!');
                        }
                        deferredPrompt = null;
                        installPrompt.style.display = 'none';
                    });
                }
            });

            closePrompt.addEventListener('click', () => {
                installPrompt.style.display = 'none';
            });
        }

        // Camera functionality
        startCameraBtn.addEventListener('click', async () => {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                video.srcObject = stream;
                startCameraBtn.disabled = true;
                captureBtn.disabled = false;
                video.style.display = 'block';
                capturedImage.style.display = 'none';
            } catch (err) {
                showNotification('Error accessing camera: ' + err.message);
            }
        });

        captureBtn.addEventListener('click', () => {
            // Set canvas dimensions to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw the video frame to the canvas
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Convert canvas to image
            capturedImage.src = canvas.toDataURL('image/png');
            
            // Stop the camera stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            // Update UI
            video.style.display = 'none';
            capturedImage.style.display = 'block';
            captureBtn.disabled = true;
            resetBtn.disabled = false;
            
            // Process the image
            recognizeText(capturedImage.src);
        });

        resetBtn.addEventListener('click', () => {
            // Reset UI state
            video.style.display = 'none';
            capturedImage.style.display = 'none';
            startCameraBtn.disabled = false;
            captureBtn.disabled = true;
            resetBtn.disabled = true;
            recognitionResults.style.display = 'none';
            bookForm.style.display = 'none';
            bookTitle.value = '';
            recognizedText.textContent = '';
        });

        // Text recognition with Tesseract.js
        async function recognizeText(imageUrl) {
            loadingIndicator.style.display = 'block';
            loadingText.textContent = 'Recognizing text...';
            
            try {
                const worker = await Tesseract.createWorker('eng');
                
                loadingText.textContent = 'Processing image...';
                const result = await worker.recognize(imageUrl);
                
                // Extract text and look for potential book titles
                const text = result.data.text;
                recognizedText.textContent = text;
                
                // Simple heuristic to extract potential book title - using first line
                const lines = text.split('\n').filter(line => line.trim().length > 0);
                if (lines.length > 0) {
                    bookTitle.value = lines[0].trim();
                }
                
                await worker.terminate();
                
                // Show recognition results
                recognitionResults.style.display = 'block';
                loadingIndicator.style.display = 'none';
                
            } catch (error) {
                showNotification('Error recognizing text: ' + error.message);
                loadingIndicator.style.display = 'none';
            }
        }

        // Book search functionality
        searchBookBtn.addEventListener('click', async () => {
            const title = bookTitle.value.trim();
            
            if (!title) {
                showNotification('Please enter a book title');
                return;
            }
            
            loadingIndicator.style.display = 'block';
            loadingText.textContent = 'Searching for book information...';
            
            try {
                // Use Open Library API to search for books
                const response = await fetch(`https://openlibrary.org/search.json?title=${encodeURIComponent(title)}&limit=1`);
                const data = await response.json();
                
                if (data.docs && data.docs.length > 0) {
                    const book = data.docs[0];
                    
                    // Fill the book form with data
                    formBookTitle.value = book.title || title;
                    formAuthor.value = book.author_name ? book.author_name.join(', ') : '';
                    formYear.value = book.first_publish_year || '';
                    formGenre.value = book.subject ? book.subject.slice(0, 3).join(', ') : '';
                    
                    // Get book description if available
                    if (book.key) {
                        try {
                            const workResponse = await fetch(`https://openlibrary.org${book.key}.json`);
                            const workData = await workResponse.json();
                            
                            formDescription.value = workData.description ? 
                                (typeof workData.description === 'string' ? workData.description : workData.description.value) : 
                                'No description available';
                        } catch (err) {
                            formDescription.value = 'Description not available';
                        }
                    } else {
                        formDescription.value = 'Description not available';
                    }
                    
                    // Reset read status and rating
                    formReadStatus.checked = false;
                    formRating.value = '0';
                    
                    // Show book form
                    bookForm.style.display = 'block';
                    recognitionResults.style.display = 'none';
                } else {
                    showNotification('No books found with this title');
                    
                    // Show empty form for manual entry
                    formBookTitle.value = title;
                    formAuthor.value = '';
                    formYear.value = '';
                    formGenre.value = '';
                    formDescription.value = 'No description available';
                    formReadStatus.checked = false;
                    formRating.value = '0';
                    
                    bookForm.style.display = 'block';
                    recognitionResults.style.display = 'none';
                }
            } catch (error) {
                showNotification('Error searching for book: ' + error.message);
                
                // Show empty form for manual entry on error
                formBookTitle.value = title;
                formAuthor.value = '';
                formYear.value = '';
                formGenre.value = '';
                formDescription.value = 'No description available';
                formReadStatus.checked = false;
                formRating.value = '0';
                
                bookForm.style.display = 'block';
                recognitionResults.style.display = 'none';
            } finally {
                loadingIndicator.style.display = 'none';
            }
        });

        // Book form handling
        saveBookBtn.addEventListener('click', () => {
            const title = formBookTitle.value.trim();
            
            if (!title) {
                showNotification('Book title is required');
                return;
            }
            
            const book = {
                id: Date.now().toString(),
                title: title,
                author: formAuthor.value.trim(),
                year: formYear.value.trim(),
                genre: formGenre.value.trim(),
                description: formDescription.value.trim(),
                read: formReadStatus.checked,
                rating: formRating.value,
                dateAdded: new Date().toISOString()
            };
            
            // Add book to collection
            books.push(book);
            saveBooks();
            
            // Show notification and reset UI
            showNotification('Book added to your library!');
            bookForm.style.display = 'none';
            resetBtn.click();
            
            // Switch to library tab
            document.querySelector('.tab[data-tab="libraryTab"]').click();
        });

        cancelBookBtn.addEventListener('click', () => {
            bookForm.style.display = 'none';
            recognitionResults.style.display = 'block';
        });

        // Book list functionality
        function renderBookList(searchTerm = '') {
            if (books.length === 0) {
                bookList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Filter books based on search term
            const filteredBooks = searchTerm ? 
                books.filter(book => {
                    const searchLower = searchTerm.toLowerCase();
                    return book.title.toLowerCase().includes(searchLower) || 
                           book.author.toLowerCase().includes(searchLower) ||
                           book.genre.toLowerCase().includes(searchLower);
                }) : 
                books;
                
            // Sort books by date added (newest first)
            filteredBooks.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
            
            // Generate HTML for book list
            bookList.innerHTML = filteredBooks.map(book => `
                <div class="book-card" data-id="${book.id}">
                    <button class="delete-btn" onclick="deleteBook('${book.id}')">Ã—</button>
                    <h3 class="book-title">${book.title}</h3>
                    <p class="book-author">by ${book.author || 'Unknown author'}</p>
                    <p class="book-info">${book.year ? `Published: ${book.year}` : ''} ${book.genre ? ` â€¢ Genre: ${book.genre}` : ''}</p>
                    <div class="book-description">${book.description || 'No description available'}</div>
                    <div class="book-actions">
                        <div class="read-status">
                            <input type="checkbox" id="read-${book.id}" ${book.read ? 'checked' : ''} onchange="updateReadStatus('${book.id}', this.checked)">
                            <label for="read-${book.id}">${book.read ? 'Read' : 'Not read'}</label>
                        </div>
                        <div class="rating">
                            <label for="rating-${book.id}">Rating:</label>
                            <select id="rating-${book.id}" onchange="updateRating('${book.id}', this.value)">
                                <option value="0" ${book.rating === '0' ? 'selected' : ''}>Not rated</option>
                                <option value="1" ${book.rating === '1' ? 'selected' : ''}>1 - Poor</option>
                                <option value="2" ${book.rating === '2' ? 'selected' : ''}>2 - Fair</option>
                                <option value="3" ${book.rating === '3' ? 'selected' : ''}>3 - Good</option>
                                <option value="4" ${book.rating === '4' ? 'selected' : ''}>4 - Very Good</option>
                                <option value="5" ${book.rating === '5' ? 'selected' : ''}>5 - Excellent</option>
                            </select>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Function to delete a book
        window.deleteBook = function(id) {
            if (confirm('Are you sure you want to delete this book?')) {
                books = books.filter(book => book.id !== id);
                saveBooks();
                renderBookList(searchQuery.value);
                showNotification('Book deleted');
            }
        };

        // Function to update read status
        window.updateReadStatus = function(id, isRead) {
            const bookIndex = books.findIndex(book => book.id === id);
            if (bookIndex !== -1) {
                books[bookIndex].read = isRead;
                saveBooks();
                document.querySelector(`label[for="read-${id}"]`).textContent = isRead ? 'Read' : 'Not read';
                showNotification('Read status updated');
            }
        };

        // Function to update rating
        window.updateRating = function(id, rating) {
            const bookIndex = books.findIndex(book => book.id === id);
            if (bookIndex !== -1) {
                books[bookIndex].rating = rating;
                saveBooks();
                showNotification('Rating updated');
            }
        };

        // LocalStorage functions
        function saveBooks() {
            localStorage.setItem('books', JSON.stringify(books));
        }

        function loadBooks() {
            const storedBooks = localStorage.getItem('books');
            if (storedBooks) {
                books = JSON.parse(storedBooks);
            }
        }

        // Utility function to show notifications
        function showNotification(message) {
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }